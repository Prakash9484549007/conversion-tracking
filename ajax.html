<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AJAX Contact Form</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav>
        
        <div class="dropdown">
            <button class="dropbtn">Contact Form 7 
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="index.html">Redirect Contact Form</a>
                <a href="ajax.html">AJAX Contact Form</a>
            </div>
        </div> 

        <a href="#wpforms">WP Form</a>

        <a href="#fluentform">Fluent Form</a>

    </nav>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            emailjs.init("KdGRcRiaKId5_bMWn"); // Your Public Key
        })();
    </script>

    <div class="contact-container">
        
        <form id="ajax-contact-form">
            <h2>AJAX Contact Form</h2>
            
            <label>Your Name</label>
            <input type="text" name="full_name" required>

            <label>Your Email</label>
            <input type="email" name="email" id="email_field" required>

            <label>Mobile Number</label>
            <input type="tel" name="mobile" id="mobile_field" placeholder="10-digit number" required>

            <label>Subject</label>
            <input type="text" name="subject" required>

            <label>Message</label>
            <textarea name="message" rows="5" required></textarea>

            <button type="submit" id="submit_btn">Send Message (No Reload)</button>
        </form>

        <div id="success_msg" class="success-message">
            <h2>✔ Message Sent!</h2>
            <p>Thank you. We have received your message without reloading the page.</p>
            <button onclick="location.reload()" style="margin-top:10px; background:#333;">Send Another</button>
        </div>

    </div>

    <script>
        // ▼▼▼ PASTE YOUR GOOGLE WEB APP URL HERE ▼▼▼
        const scriptURL = 'https://script.google.com/macros/s/YOUR_LONG_SCRIPT_URL_HERE/exec';
        // ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲

        const form = document.getElementById('ajax-contact-form');
        const successMsg = document.getElementById('success_msg');
        const btn = document.getElementById('submit_btn');

        form.addEventListener('submit', e => {
            e.preventDefault();
            
            btn.disabled = true;
            btn.innerText = 'Processing...';

            // 1. Prepare Data
            let requestBody = new FormData(form);
            const emailVal = document.getElementById('email_field').value;
            const mobileVal = document.getElementById('mobile_field').value;

            // 2. Send to Google Sheets
            fetch(scriptURL, { method: 'POST', body: requestBody })
                .then(response => {
                    console.log('Sheet Success!', response);
                    
                    // 3. Send Email
                    const serviceID = 'service_9it87w5'; 
                    const templateID = 'template_57mjstm';
                    return emailjs.sendForm(serviceID, templateID, form);
                })
                .then(() => {
                    // 4. AJAX SUCCESS (The Magic Part)
                    
                    // Hide the form
                    form.style.display = 'none';
                    
                    // Show the success message
                    successMsg.style.display = 'block';

                    // 5. TRACKING (Manually fire GTM event since URL didn't change)
                    window.dataLayer = window.dataLayer || [];
                    window.dataLayer.push({
                        'event': 'form_submission_success',
                        'user_email': emailVal,
                        'user_mobile': mobileVal
                    });
                    
                    console.log("AJAX Success: Tracking Event Fired");
                })
                .catch(error => {
                    console.error('Error!', error.message);
                    alert("Error sending message.");
                    btn.disabled = false;
                    btn.innerText = 'Send Message';
                });
        });
    </script>

</body>
</html>