<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AJAX Contact Form</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="auth.js"></script>
</head>
<body>

    <header class="site-header">
        
        <div class="site-branding">
            <span>Conversion</span> Tracking
        </div>

        <nav>
            
            <div class="dropdown">
                <button class="dropbtn">Contact Form 7 
                    <i class="fa fa-caret-down"></i> </button>
                <div class="dropdown-content">
                    <a href="index.html">Redirect Form</a>
                    <a href="ajax.html">AJAX Form</a>
                </div>
            </div> 

            <a href="wp-form.html">WP Form</a>
            <a href="fluent-form.html">Fluent Form</a>
            <a href="shop.html">E-Commerce Store</a>
            <div class="auth-container">
                <div id="google-btn"></div>

                <div id="user-profile" style="display:none;">
                    <img id="user-pic" src="" alt="Profile">
                    
                    <div class="profile-info">
                        <span id="user-name"></span>
                        <button onclick="deleteAccount()" class="delete-btn">Delete Account</button>
                    </div>
                    
                    <button onclick="logout()" class="logout-btn">Logout</button>
                </div>
            </div>


        </nav>
    </header>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            emailjs.init("KdGRcRiaKId5_bMWn"); // Your Public Key
        })();
    </script>

    <div class="contact-container">
        
        <form id="ajax-contact-form">
            <h2>AJAX Contact Form</h2>
            
            <label>Your Name</label>
            <input type="text" name="full_name" required>

            <label>Your Email</label>
            <input type="email" name="email" id="email_field" required>

            <label>Mobile Number</label>
            <input type="tel" name="mobile" id="mobile_field" placeholder="10-digit number" required>

            <label>Subject</label>
            <input type="text" name="subject" required>

            <label>Message</label>
            <textarea name="message" rows="5" required></textarea>

            <button type="submit" id="submit_btn">Send Message (No Reload)</button>
        </form>

        <div id="success_msg" class="success-message">
            <h2>✔ Message Sent!</h2>
            <p>Thank you. We have received your message without reloading the page.</p>
            <button onclick="location.reload()" style="margin-top:10px; background:#333;">Send Another</button>
        </div>

    </div>

    <script>
    // ▼▼▼ PASTE YOUR NEW GOOGLE SCRIPT URL HERE ▼▼▼
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxMjZoxFV_ffqSV_a25QUC01U0q3K17CTT9LcRrYyvIvjprIeis-SFJwAYk1hCz8iqh/exec'; 

    const form = document.getElementById('ajax-contact-form');
    const successMsg = document.getElementById('success_msg');
    const btn = document.getElementById('submit_btn');

    form.addEventListener('submit', e => {
        e.preventDefault();
        btn.disabled = true;
        btn.innerText = 'Processing...';

        // 1. Convert Form Data to JSON
        const formData = new FormData(form);
        const data = Object.fromEntries(formData); 
        
        // ▼▼▼ NEW LINE: TELL IT WHICH SHEET TO USE ▼▼▼
        data.sheetName = 'ContactForm7'; 
        // ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲

        // 2. Send JSON to Google Sheets
        fetch(scriptURL, {
            method: 'POST',
            body: JSON.stringify(data)
        })
        .then(response => {
            console.log('Sheet Success!');
            const serviceID = 'service_9it87w5'; 
            const templateID = 'template_57mjstm';
            return emailjs.sendForm(serviceID, templateID, form);
        })
        .then(() => {
            // 3. Show Success Message
            form.style.display = 'none';
            successMsg.style.display = 'block';

            // 4. Tracking
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                'event': 'form_submission_success',
                'user_email': data.email,
                'user_mobile': data.mobile
            });
        })
        .catch(error => {
            console.error('Error!', error);
            alert("Error. Please try again.");
            btn.disabled = false;
            btn.innerText = 'Send Message';
        });
    });
</script>

</body>
</html>