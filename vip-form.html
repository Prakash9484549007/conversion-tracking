<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Registration</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="auth.js"></script>
    <style>
        /* Specific Styles for Autosuggest */
        .autocomplete-items {
            position: absolute;
            border: 1px solid #d4d4d4;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 150px;
            overflow-y: auto;
            background: white;
        }
        .autocomplete-items div {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #d4d4d4;
        }
        .autocomplete-items div:hover {
            background-color: #e9e9e9;
        }
        .input-group { position: relative; margin-bottom: 15px; }
    </style>
</head>
<body>

    <header class="site-header">
        <div class="site-branding"><span>Conversion</span> Tracking</div>
        <nav>
            <a href="shop.html">Back to Shop</a>
            <div class="auth-container">
                <div id="user-profile" style="display:flex;">
                    <img id="user-pic" src="" alt="Profile">
                    <span id="user-name" style="color: white; font-weight: 600; font-size: 14px;"></span>
                    <button onclick="logout()" class="logout-btn">Logout</button>
                </div>
            </div>
        </nav>
    </header>

    <div class="contact-container" style="max-width: 500px;">
        <form id="gr-form">
            <h2>Join VIP Club</h2>
            <p style="color:#666; font-size:14px;">Get exclusive offers tailored to you.</p>

            <label>First Name</label>
            <input type="text" name="fname" required>

            <label>Last Name (Optional)</label>
            <input type="text" name="lname">

            <label>Email</label>
            <input type="email" name="email" required>

            <label>Mobile Number</label>
            <input type="tel" name="number" placeholder="+91..." required>

            <label>Gender</label>
            <div style="display:flex; gap:20px; margin-bottom:15px;">
                <label style="font-weight:normal;"><input type="radio" name="gender" value="Male"> Male</label>
                <label style="font-weight:normal;"><input type="radio" name="gender" value="Female"> Female</label>
            </div>

            <label>Interested In</label>
            <select name="interest">
                <option value="electronics">Electronics</option>
                <option value="fashion">Fashion</option>
                <option value="software">Software Services</option>
            </select>

            <label>Budget Range (₹)</label>
            <input type="range" min="1000" max="50000" oninput="document.getElementById('b-val').innerText = this.value">
            <div style="text-align:center; color:#4CAF50; font-weight:bold;">₹<span id="b-val">25000</span></div>

            <label>City (Type to search)</label>
            <div class="input-group">
                <input type="text" id="cityInput" name="city" placeholder="e.g. Mumbai" autocomplete="off">
                <div id="cityList" class="autocomplete-items"></div>
            </div>

            <button type="submit" id="submit_btn">Join Now</button>
        </form>
    </div>

    <script>
        // --- 1. INDIAN CITIES DATA ---
        const cities = ["Mumbai", "Delhi", "Bangalore", "Hyderabad", "Ahmedabad", "Chennai", "Kolkata", "Surat", "Pune", "Jaipur", "Lucknow", "Kanpur", "Nagpur", "Indore", "Thane", "Bhopal", "Visakhapatnam", "Pimpri-Chinchwad", "Patna", "Vadodara", "Ghaziabad", "Ludhiana", "Agra", "Nashik", "Ranchi", "Faridabad", "Meerut", "Rajkot", "Kalyan-Dombivli", "Vasai-Virar", "Varanasi", "Srinagar", "Aurangabad", "Dhanbad", "Amritsar", "Navi Mumbai", "Allahabad", "Howrah", "Gwalior", "Jabalpur", "Coimbatore", "Vijayawada", "Jodhpur", "Madurai", "Raipur", "Kota", "Guwahati", "Chandigarh", "Solapur", "Hubli-Dharwad", "Bareilly", "Moradabad", "Mysore", "Gurgaon", "Aligarh", "Jalandhar", "Tiruchirappalli", "Bhubaneswar", "Salem", "Mira-Bhayandar", "Warangal", "Thiruvananthapuram", "Bhiwandi", "Saharanpur", "Guntur", "Amravati", "Bikaner", "Noida", "Jamshedpur", "Bhilai", "Cuttack", "Firozabad", "Kochi", "Nellore", "Bhavnagar", "Dehradun", "Durgapur", "Asansol", "Rourkela", "Nanded", "Kolhapur", "Ajmer", "Akola", "Gulbarga", "Jamnagar", "Ujjain", "Loni", "Siliguri", "Jhansi", "Ulhasnagar", "Jammu", "Sangli-Miraj & Kupwad", "Mangalore", "Erode", "Belgaum", "Ambattur", "Tirunelveli", "Malegaon", "Gaya", "Jalgaon", "Udaipur", "Maheshtala"];

        // --- 2. AUTOSUGGEST LOGIC ---
        const cityInput = document.getElementById("cityInput");
        const cityList = document.getElementById("cityList");

        cityInput.addEventListener("input", function() {
            const val = this.value;
            cityList.innerHTML = '';
            if (!val) return;

            cities.forEach(city => {
                if (city.toLowerCase().startsWith(val.toLowerCase())) {
                    const item = document.createElement("div");
                    item.innerHTML = "<strong>" + city.substr(0, val.length) + "</strong>";
                    item.innerHTML += city.substr(val.length);
                    item.addEventListener("click", function() {
                        cityInput.value = city;
                        cityList.innerHTML = '';
                    });
                    cityList.appendChild(item);
                }
            });
        });

        // Close list if clicked outside
        document.addEventListener("click", function (e) {
            if (e.target !== cityInput) {
                cityList.innerHTML = '';
            }
        });

        // --- 3. FORM SUBMISSION ---
        document.getElementById('gr-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submit_btn');
            btn.innerText = "Processing...";
            btn.disabled = true;

            const formData = new FormData(e.target);
            const payload = {
                name: formData.get('fname') + " " + formData.get('lname'),
                email: formData.get('email'),
                phone: formData.get('number'),
                gender: formData.get('gender'),
                interest: formData.get('interest'),
                budget: document.getElementById('b-val').innerText,
                city: formData.get('city')
            };

            // Send to your Render Backend
            try {
                // REPLACE WITH YOUR RENDER URL
                const response = await fetch('https://shop-backend-0b4p.onrender.com/api/marketing/subscribe', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                
               if(result.success) {
                    alert("Welcome to the VIP Club! Check your email.");
                    e.target.reset(); // Clears the form inputs
                    // No redirect happens now. User stays here.
                } else {
                    alert("Error: " + result.error);
                }
            } catch (err) {
                console.error(err);
                alert("Connection Error");
            }
            btn.innerText = "Join Now";
            btn.disabled = false;
        });
    </script>

</body>
</html>